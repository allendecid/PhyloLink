PhyloDisplay=function(a,b,c,d,e){function t(){function u(){function y(a,b,c){return a.replace(new RegExp(z(b),"g"),c)}function z(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function A(a){a.isSelected?d3.select(this).style("fill","lightsteelblue").attr("r","3.5"):d3.select(this).style("fill",function(a){return j(a.group)}).attr("r","5.5")}function B(a){a.isSelected?d3.select(this).style("fill","#fff").attr("r","2.5"):d3.select(this).style("fill","#F94D00").attr("r","5.5")}function C(a,b){var c=function(a,b){if(b(a),a.children)for(var d=a.children.length-1;d>=0;d--)c(a.children[d],b)};c(a[0],function(a){a.rootDist=(a.parent?a.parent.rootDist:0)+(a.branchlength||0)});var d=a.map(function(a){return a.rootDist}),e=d3.scale.linear().domain([0,d3.max(d)]).range([0,b]);return c(a[0],function(a){a.y=e(a.rootDist)}),e}function D(a){function b(a,c){a.children&&a.children.forEach(function(a){a.children&&E(a)&&(c=1,console.log(c)),b(a,c)}),a.change=c,console.log(a.change)}return b(a,0),a}function E(a){function d(a){a.children?(b.push(a.branchlength),a.children.forEach(function(a){d(a)})):c.push(a.branchlength)}var b=[],c=[];return d(a),b>c?!0:!1}function F(a){function g(a,b,c,d){0===c?a.children?(a.code="papa",a.children.forEach(function(c){c.branchlength>=f?c.children?(c.group=c.id,g(c,b+1,1,c.group)):(c.group=e,e-=1,q+=1,r+=a.branchlength):c.branchlength<f&&(c.group=0,g(c,b+1,0,c.group))})):(q+=1,r+=a.branchlength):1===c&&(a.children?(a.code="papa",a.children.forEach(function(c){c.branchlength>=f?c.children?(c.group=c.id,g(c,b+1,1,c.group)):(c.group=e,e-=1,q+=1,r+=a.branchlength):c.branchlength<f&&(c.group=d,g(c,b+1,1,c.group))})):(q+=1,r+=a.branchlength))}var e=-1,f=d;return g(a,1,0,0),a}function G(a){function f(a,b,c,d){0===c?a.children?(a.code="papa",a.children.forEach(function(c){c.children?c.branchlength>=e?(c.group=c.id,f(c,b+1,1,c.group)):c.branchlength<e&&(c.group=d,f(c,b+1,0,c.group)):(c.group=d,q+=1,r+=a.branchlength)})):(q+=1,r+=a.branchlength):1===c&&(a.children?(a.code="papa",a.children.forEach(function(c){c.children?c.branchlength>=e?(c.group=c.id,f(c,b+1,1,c.group)):c.branchlength<e&&(c.group=d,f(c,b+1,1,c.group)):(c.group=d,q+=1,r+=a.branchlength)})):(q+=1,r+=a.branchlength))}var e=d;return f(a,1,0,0),a}function H(a){function f(a,b,c,d){0===c?a.children?(a.code="papa",a.children.forEach(function(c){c.children||0!==c.change?c.branchlength>=e?(c.group=c.id,f(c,b+1,1,c.group)):c.branchlength<e&&(c.group=d,f(c,b+1,0,c.group)):(c.group=d,q+=1,r+=a.branchlength)})):(q+=1,r+=a.branchlength):1===c&&(a.children?(a.code="papa",a.children.forEach(function(c){c.children||0!==c.change?c.branchlength>=e?(c.group=c.id,f(c,b+1,1,c.group)):c.branchlength<e&&(c.group=d,f(c,b+1,1,c.group)):(c.group=d,q+=1,r+=a.branchlength)})):(q+=1,r+=a.branchlength))}var e=d;return f(a,1,0,0),a}var b=d3.scale.category20(),j=d3.scale.category20();if(1===h&&(c={"":"Transparent"},c[k[h]]="#90c843"),2===h&&(1===m&&(c={"":"Transparent"},c[k[h-1]]="#90c843",c[k[h]]="#A80000",m=0),c[k[h]]={},c[k[h]]="#A80000"),3===h&&(1===m&&(c={"":"Transparent"},c[k[h-2]]="#90c843",c[k[h-1]]="#A80000",c[k[h]]="#555555",m=0),c[k[h]]={},c[k[h]]="#555555"),0!==n)for(c={"":"Transparent"},i=0;i<o.length;i++)c[o[i]]=b(o[i]);var l=a,s=y(l," ",""),t=nwk.parser.parse(s),u=nwk.converter.toBinary(t),v=nwk.converter.toJSON(u),w=y(v,',"children":[]',""),x=JSON.parse(w);q=0,1===e?x=G(x):0===e?x=F(x):3===e&&(x=D(x),x=H(x)),Phylodiag=function(){function c(c){var e=c.source,f=c.target,i=((e.x+f.x)/2,(e.y+f.y)/2,[e,{x:f.x,y:e.y},f]);return i=i.map(a),b(i)}var a=function(a){return[a.y,a.x]},b=function(a){return"M"+a[0]+" "+a[1]+" "+a[2]};return c.projection=function(b){return arguments.length?(a=b,c):a},c.path=function(a){return arguments.length?(b=a,c):b},c},PhyloAngle=function(a,b){var c=2*Math.PI,d=c/4,e=a[0]>=0?a[1]>=0?1:2:a[1]>=0?4:3,f=Math.abs(Math.asin(a[1]/b));switch(e){case 1:coordAngle=d-f;break;case 2:coordAngle=d+f;break;case 3:coordAngle=2*d+d-f;break;case 4:coordAngle=3*d+f}return coordAngle},PhyloNodes=function(a){a.selectAll("g.leaf.node").append("svg:circle").attr("r","3.5").attr("fill","lightsteelblue").attr("stroke",function(a){return j(a.group)}).attr("stroke-width","2px").attr("fill",function(a){return j(a.group)}).on("click",A),a.selectAll("g.inner.node").append("svg:circle").attr("r","2.5").attr("fill","#fff").attr("stroke","steelblue").attr("stroke-width","2px").on("click",B),a.selectAll("g.root.node").append("svg:circle").attr("r",4.5).attr("fill","steelblue").attr("stroke","#369").attr("stroke-width","2px")},phylodraw=function(a){function o(){n.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")"),n.selectAll("rect").attr("width",3.5/l.scale()).attr("height",7/l.scale()),n.selectAll("ellipse").attr("rx",2/l.scale()).attr("ry",4/l.scale()),n.selectAll("line").attr("y1",-3/l.scale()).attr("y2",3/l.scale()).attr("stroke-width",5/l.scale()),n.selectAll("path.link").attr("stroke-width",2/l.scale())}var b=$(window).height();11*q>$(window).height()&&(b=11*q);var c=$(window).width(),d=b,e=d3.layout.cluster().size([d,c]).sort(function(a){return a.children?a.children.length:-1}).children(function(a){return a.children}),a=e(a),l=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",o),m=Phylodiag(),n=d3.select("#tree-container").append("svg:svg").attr("width",c+300).attr("height",$(document).height()+50).attr("class","overlay").call(l).append("svg:g").attr("transform","translate(20, 20)");return C(a,c),n.selectAll("path.link").data(e.links(a)).enter().append("svg:path").attr("class","link").attr("d",m).attr("fill","none").attr("stroke",function(a){return j(a.target.group)}).attr("stroke-width","2px"),n.selectAll("g.node").data(a).enter().append("svg:g").attr("class",function(a){return a.children?0==a.depth?"root node":"inner node":"leaf node"}).attr("transform",function(a){return"translate("+a.y+","+a.x+")"}),d3.select("body").append("div").attr("class","tooltip").style("opacity",0),PhyloNodes(n),n.selectAll("g.inner.node").append("svg:text").attr("dx",-6).attr("dy",-6).attr("text-anchor","end").attr("font-size","5").attr("fill","#606060 ").text(function(a){return a.name}),n.selectAll("g.leaf.node").append("svg:text").attr("dx",8).attr("dy",3).attr("text-anchor","start").attr("font-size","7").attr("fill",function(a){return j(a.group)}).text(function(a){return a.name}),{tree:e,vis:n}},phylodraw(x)}var c={"":"Transparent"};q=0,r=0,u()}var o,q,h=0,k=[],m=0,n=0,r=0;t()};
