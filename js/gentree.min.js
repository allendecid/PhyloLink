function gentree(a,b,c){d3.text("./uploads/"+a,function(a){function l(a,b,c){return a.replace(new RegExp(m(b),"g"),c)}function m(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function n(a,b){var c=function(a,b){if(b(a),a.children)for(var d=a.children.length-1;d>=0;d--)c(a.children[d],b)};c(a[0],function(a){a.rootDist=(a.parent?a.parent.rootDist:0)+(a.branchlength||0)});var d=a.map(function(a){return a.rootDist}),e=d3.scale.linear().domain([0,d3.max(d)]).range([0,b]);return c(a[0],function(a){a.y=e(a.rootDist)}),e}function o(a){function g(a,b,d,e){0===d?a.children&&(a.code="papa",a.children.forEach(function(a){if(a.branchlength>=f)if(a.children){a.group=a.id,a.tagged=a.id;var h=b.push({id:a.id,name:a.name,branchlength:a.branchlength,tagged:a.id,size:0,inside:"",children:[]})-1;totalpie+=2,g(a,b[h].children,1,b[h])}else;else a.branchlength<f&&(c.size+=1,a.children||(c.inside=c.inside+a.name+"\n"),g(a,b,0,e))})):1===d&&a.children&&(a.code="papa",a.children.forEach(function(a){if(a.branchlength>=f)if(a.children){a.group=a.id,a.tagged=a.id;var d=b.push({id:a.id,name:a.name,branchlength:a.branchlength,tagged:a.id,size:0,inside:"",children:[]})-1;totalpie+=2,g(a,b[d].children,1,b[d])}else;else a.branchlength<f&&(e.size+=1,a.children||(e.inside=e.inside+a.name+"\n"),g(a,b,1,e))}))}var c={id:169,name:"",branchlength:0,size:0,inside:"",children:[]},f=b;return g(a,c.children,0,c),c}function p(a){function g(a,b,d,h){0===d?a.children&&(a.code="papa",a.children.forEach(function(a){if(a.branchlength>=f)if(a.children){a.group=a.id,a.tagged=a.id;var i=b.push({id:a.id,name:a.name,branchlength:a.branchlength,tagged:a.id,size:0,inside:"",children:[]})-1;totalpie+=2,g(a,b[i].children,1,b[i])}else a.group=e,e-=1,a.tagged=-a.id,b.push(a),totalpie+=2;else a.branchlength<f&&(c.size+=1,a.children||(c.inside=c.inside+a.name+"\n"),g(a,b,0,h))})):1===d&&a.children&&(a.code="papa",a.children.forEach(function(a){if(a.branchlength>=f)if(a.children){a.group=a.id,a.tagged=a.id;var d=b.push({id:a.id,name:a.name,branchlength:a.branchlength,tagged:a.id,size:0,inside:"",children:[]})-1;totalpie+=2,g(a,b[d].children,1,b[d])}else a.group=e,e-=1,a.tagged=-a.id,b.push(a),totalpie+=2;else a.branchlength<f&&(h.size+=1,a.children||(h.inside=h.inside+a.name+"\n"),g(a,b,1,h))}))}var c={id:169,name:"",branchlength:0,size:0,inside:"",children:[]},e=-1,f=b;return g(a,c.children,0,c),c}var d=a,e=l(d," ",""),f=nwk.parser.parse(e),g=nwk.converter.toBinary(f),h=nwk.converter.toJSON(g),i=l(h,',"children":[]',""),j=JSON.parse(i);console.log(c),"1"===c&&(j=p(j)),"0"===c&&(j=o(j)),console.log(JSON.stringify(j));var k=d3.scale.category20();Phylodiag=function(){function c(c){var e=c.source,f=c.target,i=((e.x+f.x)/2,(e.y+f.y)/2,[e,{x:f.x,y:e.y},f]);return i=i.map(a),b(i)}var a=function(a){return[a.y,a.x]},b=function(a){return"M"+a[0]+" "+a[1]+" "+a[2]};return c.projection=function(b){return arguments.length?(a=b,c):a},c.path=function(a){return arguments.length?(b=a,c):b},c},PhyloAngle=function(a,b){var c=2*Math.PI,d=c/4,e=a[0]>=0?a[1]>=0?1:2:a[1]>=0?4:3,f=Math.abs(Math.asin(a[1]/b));switch(e){case 1:coordAngle=d-f;break;case 2:coordAngle=d+f;break;case 3:coordAngle=2*d+d-f;break;case 4:coordAngle=3*d+f}return coordAngle},PhyloNodes=function(a){a.selectAll("g.leaf.node").append("svg:circle").attr("r",function(a){return a.size?1+3*Math.log(a.size):4}).attr("fill",function(a){return a.tagged?k(a.tagged):void 0}).attr("stroke","#369").attr("stroke-width","2px"),a.selectAll("g.inner.node").append("svg:circle").attr("r",function(a){return a.size?1+3*Math.log(a.size):4}).attr("fill",function(a){return a.tagged?k(a.tagged):void 0}).attr("stroke","#369").attr("stroke-width","2px"),a.selectAll("g.root.node").append("svg:circle").attr("r",function(a){return a.size?1+3*Math.log(a.size):4}).attr("fill","steelblue").attr("stroke","#369").attr("stroke-width","2px")},phylodraw=function(a){function i(){h.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")"),h.selectAll("path.link").attr("stroke-width",1.5/f.scale())}var b=$(document).height();9*totalpie>$(document).height()&&(b=9*totalpie);var c=$(document).width(),d=b,e=d3.layout.cluster().size([d,c]).sort(function(a){return a.children?a.children.length:-1}).children(function(a){return a.children}),f=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",i),g=Phylodiag(),h=d3.select("body").append("svg:svg").attr("width",c+300).attr("height",d+50).attr("class","overlay").call(f).append("svg:g").attr("transform","translate(20, 20)"),a=e(a);n(a,c),h.selectAll("path.link").data(e.links(a)).enter().append("svg:path").attr("class","link").attr("d",g).attr("fill","none").attr("stroke","#383838").attr("stroke-width","1.5px"),h.selectAll("g.node").data(a).enter().append("svg:g").attr("class",function(a){return a.children?0==a.depth?"root node":"inner node":"leaf node"}).attr("transform",function(a){return"translate("+a.y+","+a.x+")"}).on("mouseover",function(a){o.transition().duration(200).style("opacity",.9),o.html(a.inside).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(){o.transition().duration(500).style("opacity",0)});var o=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);return PhyloNodes(h),h.selectAll("g.inner.node").append("svg:text").attr("dx",-6).attr("dy",-6).attr("text-anchor","end").attr("font-size","5").attr("fill","#606060 ").text(function(a){return a.name}),h.selectAll("g.leaf.node").append("svg:text").attr("dx",8).attr("dy",3).attr("text-anchor","start").attr("font-size","7").attr("fill",function(){return"black"}).text(function(a){return a.name}),{tree:e,vis:h}},phylodraw(j)})}function goToURL2(){var a="clustertree_1.html?";a=a+"tree="+arbol+"&"+"corte="+corte,$(location).attr("href",a),window.location=a}function goToURL3(){var a="clustertree_3.html?";a=a+"tree="+arbol+"&"+"corte="+corte+"&"+"op="+0,$(location).attr("href",a),window.location=a}$(document).ready(function(){$("#btnSubmitm").click(function(){goToURL2()})}),$(document).ready(function(){$("#btnSubmitm1").click(function(){goToURL3()})});
