function Clusdraw(a,b){d3.text("./uploads/"+a,function(a){function k(a,b,c){return a.replace(new RegExp(l(b),"g"),c)}function l(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function m(a,b){var c=function(a,b){if(b(a),a.children)for(var d=a.children.length-1;d>=0;d--)c(a.children[d],b)};c(a[0],function(a){a.rootDist=(a.parent?a.parent.rootDist:0)+(a.branchlength||0)});var d=a.map(function(a){return a.rootDist}),e=d3.scale.linear().domain([0,d3.max(d)]).range([0,b]);return c(a[0],function(a){a.y=e(a.rootDist)}),e}function n(a){function g(a,b,c,d){0===c?(a.children&&(a.code="papa",a.children.forEach(function(a){a.branchlength>=f?a.children?(a.group=a.id,g(a,b+1,1,a.group)):(a.group=e,e-=1):a.branchlength<f&&(a.group=0,g(a,b+1,0,a.group))})),totalpie+=1):1===c&&(a.children?(a.code="papa",a.children.forEach(function(a){a.branchlength>=f?a.children?(a.group=a.id,g(a,b+1,1,a.group)):(a.group=e,e-=1):a.branchlength<f&&(a.group=d,g(a,b+1,1,a.group))})):totalpie+=1)}var e=-1,f=b;return g(a,1,0,0),a}var c=a,d=k(c," ",""),e=nwk.parser.parse(d),f=nwk.converter.toBinary(e),g=nwk.converter.toJSON(f),h=k(g,',"children":[]',""),i=JSON.parse(h);i=n(i);var j=d3.scale.category20();Phylodiag=function(){function c(c){var e=c.source,f=c.target,i=((e.x+f.x)/2,(e.y+f.y)/2,[e,{x:f.x,y:e.y},f]);return i=i.map(a),b(i)}var a=function(a){return[a.y,a.x]},b=function(a){return"M"+a[0]+" "+a[1]+" "+a[2]};return c.projection=function(b){return arguments.length?(a=b,c):a},c.path=function(a){return arguments.length?(b=a,c):b},c},PhyloAngle=function(a,b){var c=2*Math.PI,d=c/4,e=a[0]>=0?a[1]>=0?1:2:a[1]>=0?4:3,f=Math.abs(Math.asin(a[1]/b));switch(e){case 1:coordAngle=d-f;break;case 2:coordAngle=d+f;break;case 3:coordAngle=2*d+d-f;break;case 4:coordAngle=3*d+f}return coordAngle},PhyloNodes=function(a){a.selectAll("g.leaf.node").append("svg:circle"),a.selectAll("g.root.node").append("svg:circle").attr("r",4.5).attr("fill","steelblue").attr("stroke","#369").attr("stroke-width","2px")},phylodraw=function(a){function i(){h.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")"),h.selectAll("rect").attr("width",5/f.scale()).attr("height",5/f.scale()),h.selectAll("ellipse").attr("rx",2/f.scale()).attr("ry",4/f.scale()),h.selectAll("line").attr("y1",-3/f.scale()).attr("y2",3/f.scale()).attr("stroke-width",5/f.scale()),h.selectAll("path.link").attr("stroke-width",1.5/f.scale())}var b=$(document).height();9*totalpie>$(document).height()&&(b=9*totalpie);var c=$(document).width(),d=b,e=d3.layout.cluster().size([d,c]).sort(function(a){return a.children?a.children.length:-1}).children(function(a){return a.children}),f=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",i),g=Phylodiag(),h=d3.select("body").append("svg:svg").attr("width",c+300).attr("height",d+50).attr("class","overlay").call(f).append("svg:g").attr("transform","translate(20, 20)"),a=e(a);m(a,c);var n=h.selectAll("path.link").data(e.links(a)).enter().append("svg:path").attr("class","link").attr("d",g).attr("fill","none").attr("stroke","#ccc").attr("stroke-width","1.5px");return n.data(a).attr("class",null),h.selectAll("g.node").data(a).enter().append("svg:g").attr("class",function(a){return a.children?0==a.depth?"root node":"inner node":"leaf node"}).attr("transform",function(a){return"translate("+a.y+","+a.x+")"}),d3.select("body").append("div").attr("class","tooltip").style("opacity",0),PhyloNodes(h),h.selectAll("g.inner.node").append("svg:text").attr("dx",-6).attr("dy",-6).attr("text-anchor","end").attr("font-size","5").attr("fill","#606060 ").text(function(a){return a.name}),h.selectAll("g.leaf.node").append("svg:text").attr("dx",8).attr("dy",3).attr("text-anchor","start").attr("font-size","7").attr("fill",function(a){return j(a.group)}).text(function(a){return a.name}),{tree:e,vis:h}},phylodraw(i)})}function goToURL2(){var a="clustertree_1.html?";a=a+"tree="+arbol+"&"+"corte="+corte,$(location).attr("href",a),window.location=a}function goToURL3(){var a="clustertree_3.html?";a=a+"tree="+arbol+"&"+"corte="+corte+"&"+"op="+1,$(location).attr("href",a),window.location=a}$(document).ready(function(){$("#btnSubmitm").click(function(){goToURL2()})}),$(document).ready(function(){$("#btnSubmitm1").click(function(){goToURL3()})});
